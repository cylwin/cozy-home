// Generated by CoffeeScript 1.9.3
var Bank, BankAccount, async, cozydb;

cozydb = require('cozydb');

async = require('async');

Bank = cozydb.getModel('Bank', {
  uuid: String,
  name: String
});

module.exports = BankAccount = cozydb.getModel('Bankaccount', {
  bank: String,
  title: String,
  iban: String
});

BankAccount.listIbans = function(callback) {
  return Bank.request("byUuid", {}, function(err, banks) {
    var bank, groupedByUuidBank, i, len;
    groupedByUuidBank = {};
    for (i = 0, len = banks.length; i < len; i++) {
      bank = banks[i];
      groupedByUuidBank[bank.uuid] = bank;
    }
    return BankAccount.request("all", {}, function(err, accounts) {
      var account, j, len1, listIbans;
      listIbans = [];
      for (j = 0, len1 = accounts.length; j < len1; j++) {
        account = accounts[j];
        if (account.iban) {
          listIbans.push(account);
          account.bankName = groupedByUuidBank[account.bank].name;
        }
      }
      return callback(null, listIbans);
    });
  });
};
